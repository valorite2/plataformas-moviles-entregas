<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Lista de Contactos - DOM y JavaScript</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <style>
        .list-group-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .contact-info {
            flex-grow: 1;
        }

        .contact-actions {
            display: flex;
            gap: 10px;
        }

        .favorite-icon {
            cursor: pointer;
            color: rgb(5, 5, 5);
        }

        .favorite-icon.favorited {
            color: rgb(255, 8, 0);
        }
    </style>
</head>
<body>
    <div class="container my-1 my-sm-2 my-md-4 my-lg-5">
        <h1>Lista de Contactos</h1>
        <div class="card">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h2>Contactos</h2>
                    <div>
                        <div class="btn-group">
                            <button class="btn btn-outline-secondary dropdown-toggle" type="button"
                                data-bs-toggle="dropdown" aria-expanded="false">
                                Ordenar por
                            </button>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#" data-sort="nombre">Nombre</a></li>
                                <li><a class="dropdown-item" href="#" data-sort="apellido">Apellido</a></li>
                            </ul>
                        </div>
                        <button id="btn-mostrar-favoritos" class="btn btn-warning">
                            <i class="bi-star-fill"></i> Mostrar Favoritos
                        </button>
                    </div>
                </div>
                <div class="input-group mb-3">
                    <input type="text" class="form-control" id="input-buscador" placeholder="Buscar por nombre, apellido o teléfono">
                </div>
                <ul id="lista-contactos" class="list-group"></ul>
                <hr class="hr">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h2>Nuevo Contacto</h2>
                    <button id="btn-eliminar-seleccionados" class="btn btn-danger d-none">Eliminar Seleccionados</button>
                </div>
                <form id="form-contacto">
                    <div class="input-group mb-3">
                        <input type="text" class="form-control" name="nombre" id="input-nombre" placeholder="Nombre" aria-label="Nombre" required>
                        <input type="text" class="form-control" name="apellido" id="input-apellido" placeholder="Apellido" aria-label="Apellido" required>
                        <input type="tel" class="form-control" name="telefono" id="input-telefono" placeholder="Teléfono" aria-label="Teléfono" required>
                    </div>
                    <button class="btn btn-primary" type="submit" id="btn-submit">Agregar Contacto</button>
                </form>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO"
        crossorigin="anonymous"></script>
    <script type="text/javascript">
        let contactos = [{
            id: 1,
            nombre: 'Lucas',
            apellido: 'Perez',
            telefono: '1123456789',
            favorito: false
        }, {
            id: 2,
            nombre: 'Tomas',
            apellido: 'López',
            telefono: '1198765432',
            favorito: true
        }];

        let filtroActual = '';
        let ordenActual = 'nombre';
        let soloFavoritos = false;
        let contactoIdCounter = contactos.length > 0 ? Math.max(...contactos.map(c => c.id)) + 1 : 1;

        const listaContactosEl = document.querySelector('#lista-contactos');
        const formContactoEl = document.querySelector('#form-contacto');
        const inputBuscadorEl = document.querySelector('#input-buscador');
        const btnMostrarFavoritosEl = document.querySelector('#btn-mostrar-favoritos');
        const btnEliminarSeleccionadosEl = document.querySelector('#btn-eliminar-seleccionados');

        function agregarContacto(nombre, apellido, telefono) {
            const nuevoContacto = {
                id: contactoIdCounter++,
                nombre: nombre,
                apellido: apellido,
                telefono: telefono,
                favorito: false
            };
            contactos.push(nuevoContacto);
            mostrarListado();
        }

        function editarContacto(id, nuevoNombre, nuevoApellido, nuevoTelefono) {
            const contacto = contactos.find(c => c.id === id);
            if (contacto) {
                contacto.nombre = nuevoNombre;
                contacto.apellido = nuevoApellido;
                contacto.telefono = nuevoTelefono;
            }
            mostrarListado();
        }

        function eliminarContacto(id) {
            contactos = contactos.filter(c => c.id !== id);
            mostrarListado();
        }

        function toggleFavorito(id) {
            const contacto = contactos.find(c => c.id === id);
            if (contacto) {
                contacto.favorito = !contacto.favorito;
            }
            mostrarListado();
        }

        function mostrarListado() {
            let contactosFiltrados = contactos;

            if (soloFavoritos) {
                contactosFiltrados = contactos.filter(c => c.favorito);
            }

            if (filtroActual) {
                const filtroLower = filtroActual.toLowerCase();
                contactosFiltrados = contactosFiltrados.filter(c =>
                    c.nombre.toLowerCase().includes(filtroLower) ||
                    c.apellido.toLowerCase().includes(filtroLower) ||
                    c.telefono.toLowerCase().includes(filtroLower)
                );
            }

            contactosFiltrados.sort((a, b) => {
                const valA = a[ordenActual].toLowerCase();
                const valB = b[ordenActual].toLowerCase();
                return valA.localeCompare(valB);
            });

            listaContactosEl.innerHTML = '';

            contactosFiltrados.forEach(contacto => {
                const li = document.createElement('li');
                li.className = 'list-group-item';
                li.dataset.id = contacto.id;

                li.innerHTML = `
                    <div class="contact-info">
                        <input type="checkbox" class="form-check-input me-2 check-eliminar">
                        <span class="nombre-span">${contacto.nombre}</span>
                        <span class="apellido-span">${contacto.apellido}</span>
                        <span class="telefono-span">${contacto.telefono}</span>
                    </div>
                    <div class="contact-actions">
                        <i class="favorite-icon bi bi-star-fill ${contacto.favorito ? 'favorited' : ''}" data-id="${contacto.id}"></i>
                        <button class="btn btn-sm btn-info btn-editar" data-id="${contacto.id}">Editar</button>
                        <button class="btn btn-sm btn-danger btn-eliminar" data-id="${contacto.id}">Eliminar</button>
                    </div>
                `;
                listaContactosEl.appendChild(li);
            });

            const contactosSeleccionados = document.querySelectorAll('.check-eliminar:checked').length;
            if (contactosSeleccionados > 0) {
                btnEliminarSeleccionadosEl.classList.remove('d-none');
            } else {
                btnEliminarSeleccionadosEl.classList.add('d-none');
            }
        }

        function handlerFormulario(e) {
            e.preventDefault();
            const inputNombre = document.querySelector('#input-nombre');
            const inputApellido = document.querySelector('#input-apellido');
            const inputTelefono = document.querySelector('#input-telefono');
            const btnSubmit = document.querySelector('#btn-submit');

            const contactoId = btnSubmit.dataset.editingId;

            if (contactoId) {
                editarContacto(parseInt(contactoId), inputNombre.value, inputApellido.value, inputTelefono.value);
                btnSubmit.textContent = 'Agregar Contacto';
                delete btnSubmit.dataset.editingId;
            } else {
                agregarContacto(inputNombre.value, inputApellido.value, inputTelefono.value);
            }

            formContactoEl.reset();
        }

        function handlerBuscador(e) {
            filtroActual = e.target.value;
            mostrarListado();
        }

        function handlerAcciones(e) {
            if (e.target.classList.contains('btn-eliminar')) {
                const id = parseInt(e.target.dataset.id);
                eliminarContacto(id);
            }

            if (e.target.classList.contains('btn-editar')) {
                const id = parseInt(e.target.dataset.id);
                const contacto = contactos.find(c => c.id === id);
                if (contacto) {
                    document.querySelector('#input-nombre').value = contacto.nombre;
                    document.querySelector('#input-apellido').value = contacto.apellido;
                    document.querySelector('#input-telefono').value = contacto.telefono;
                    document.querySelector('#btn-submit').textContent = 'Guardar Cambios';
                    document.querySelector('#btn-submit').dataset.editingId = contacto.id;
                }
            }

            if (e.target.classList.contains('favorite-icon')) {
                const id = parseInt(e.target.dataset.id);
                toggleFavorito(id);
            }

            if (e.target.classList.contains('check-eliminar')) {
                const contactosSeleccionados = document.querySelectorAll('.check-eliminar:checked').length;
                if (contactosSeleccionados > 0) {
                    btnEliminarSeleccionadosEl.classList.remove('d-none');
                } else {
                    btnEliminarSeleccionadosEl.classList.add('d-none');
                }
            }
        }

        function handlerOrdenar(e) {
            e.preventDefault();
            if (e.target.dataset.sort) {
                ordenActual = e.target.dataset.sort;
                mostrarListado();
            }
        }

        function handlerMostrarFavoritos() {
            soloFavoritos = !soloFavoritos;
            btnMostrarFavoritosEl.classList.toggle('active', soloFavoritos);
            mostrarListado();
        }

        function handlerEliminarSeleccionados() {
            const checkboxes = document.querySelectorAll('.check-eliminar:checked');
            const idsAEliminar = Array.from(checkboxes).map(checkbox => parseInt(checkbox.closest('li').dataset.id));
            contactos = contactos.filter(c => !idsAEliminar.includes(c.id));
            mostrarListado();
        }

        formContactoEl.addEventListener('submit', handlerFormulario);
        listaContactosEl.addEventListener('click', handlerAcciones);
        document.querySelectorAll('.dropdown-item').forEach(item => {
            item.addEventListener('click', handlerOrdenar);
        });
        btnMostrarFavoritosEl.addEventListener('click', handlerMostrarFavoritos);
        btnEliminarSeleccionadosEl.addEventListener('click', handlerEliminarSeleccionados);
        inputBuscadorEl.addEventListener('input', handlerBuscador);

        mostrarListado();
    </script>
</body>
</html>